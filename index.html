<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PIX API - Banco BV (melhorado)</title>

<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />

<style>
  /* Reset / box model */
  *,*::before,*::after { box-sizing: border-box; }
  html, body {
    margin: 0;
    min-height: 100%;
    height: 100%;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Helvetica;
    background: #f5f7fb;
    color: #0b1220;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x: hidden; /* evita scroll horizontal */
  }

  :root{
    --sidebar-width: 260px;
    --right-width: 420px;
    --brand: #0f6fb2;
    --muted: #6b7280;
    --bg: #f5f7fb;
    --card: #ffffff;
    --panel-bg: #12171a;
    --panel-card: #0f1617;
    --accent: #14b8a6;
  }

  /* ===== LAYOUT ===== */
  .layout {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr var(--right-width);
    gap: 0;
    min-height: 100vh;
    align-items: start;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    background: var(--card);
    border-right: 1px solid rgba(15,23,42,0.06);
    padding: 18px;
    display:flex;
    flex-direction:column;
    gap:14px;
    position: relative;
  }

  .brand { display:flex; align-items:center; gap:12px; padding-bottom:6px; border-bottom:1px solid rgba(2,6,23,0.03); }
  .brand-logo { height:44px; width:auto; display:block; }
  .brand-text { font-weight:800; font-size:15px; }

  .sidebar .search input[type="search"] {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid rgba(2,6,23,0.06);
    background: #fbfdff;
    font-size: 14px;
    outline: none;
  }

  .nav { margin:0; padding:0; list-style:none; overflow:visible; }

  .menu-section { margin-bottom:8px; }

  .menu-heading { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px; color:var(--muted); font-weight:600; font-size:13px; }
  .menu-heading .count { background: rgba(15,111,178,0.08); color:var(--brand); padding:4px 8px; border-radius:999px; font-size:12px; }

  .tag-item {
    display:block;
    margin-bottom:8px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
    color:#0b1220;
    transition: background .12s, transform .06s;
    padding: 8px;
    border: 1px solid transparent;
    text-align: left;
  }
  .tag-item:hover { background: rgba(2,6,23,0.03); transform: translateY(-1px); }
  .tag-item.active { background: linear-gradient(180deg,#f2f8ff,#ffffff); border:1px solid rgba(15,111,178,0.06); box-shadow: 0 6px 18px rgba(12,37,63,0.04); }

  .ops { margin-top:8px; padding-left:4px; display:flex; flex-direction:column; gap:6px; }

  .op-link {
    display:flex;
    gap:10px;
    align-items:center;
    padding:8px;
    border-radius:8px;
    font-size:13px;
    color:#263238;
    background: transparent;
    border: none;
    text-align:left;
    cursor:pointer;
  }
  .op-link:hover { background: rgba(2,6,23,0.03); transform: translateY(-1px); }
  .op-link.active { background: rgba(2,6,23,0.04); box-shadow: inset 3px 0 0 var(--brand); color:#0b1220; font-weight:700; }

  .method-pill-left {
    padding:6px 10px;
    border-radius:8px;
    font-weight:800;
    font-size:11px;
    color:#fff;
    min-width:54px;
    text-align:center;
  }
  .method-get { background:#16a34a; }
  .method-post { background:#0ea5e9; }
  .method-put { background:#f59e0b; color:#0b1220; }
  .method-delete { background:#ef4444; }

  .op-path { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size:12px; color:#6b7280; }

  /* ===== CONTENT ===== */
  .content {
    background: transparent;
    padding: 28px 42px;
  }

  .swagger-ui {
    background: var(--card);
    border-radius: 12px;
    padding: 22px;
    box-shadow: 0 10px 30px rgba(9,30,66,0.06);
    color: #0b1220;
    overflow: visible !important;
    max-width: none;
  }

  /* Make swagger internals more predictable and avoid broken layouts */
  .swagger-ui .wrapper, 
  .swagger-ui .info, 
  .swagger-ui .opblock, 
  .swagger-ui .block, 
  .swagger-ui .content {
    width: 100% !important;
    max-width: 100% !important;
  }

  .swagger-ui .scheme-container { margin-top: 8px; margin-bottom: 8px; }
  .swagger-ui .info .title { font-size: 26px; margin-bottom: 6px; }
  .swagger-ui .info .description { font-size: 14px; color: var(--muted); }

  /* Ensure opblocks don't create horizontal scrolls: wrap code & paths */
  .swagger-ui .opblock .opblock-summary-path,
  .swagger-ui .opblock .opblock-summary-method,
  .swagger-ui .opblock pre,
  .swagger-ui .opblock code,
  .swagger-ui .opblock .opblock-title,
  .swagger-ui .markdown {
    word-break: break-word;
    white-space: normal !important;
  }

  .swagger-ui .opblock { border: none; box-shadow: none; margin-bottom: 14px; }

  /* ===== RIGHT PANEL ===== */
  .code-panel {
    background: linear-gradient(180deg,var(--panel-bg),#0c1113);
    border-left: 1px solid rgba(255,255,255,0.03);
    padding: 18px;
    color: #e6fbf4;
    display:flex;
    flex-direction:column;
    gap:18px;
    position: relative;
    align-self: start;
    overflow: visible;
  }

  .endpoint-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .endpoint-title { display:flex; align-items:center; gap:8px; }

  .method-pill { padding:6px 10px; border-radius:8px; font-weight:800; font-size:12px; color:#fff; }
  .method-pill.get { background:#16a34a; }
  .method-pill.post { background:#0ea5e9; }
  .method-pill.put { background:#f59e0b; color:#0b1220; }
  .method-pill.delete { background:#ef4444; }

  .path-text { color: rgba(255,255,255,0.96); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size:13px; }

  .controls { display:flex; gap:8px; align-items:center; }
  .btn {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.03);
    color: #e8fbf5;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
  }
  .btn.primary { background: linear-gradient(90deg,#0ea5e9,#14b8a6); color:#06202a; font-weight:800; border:none; }

  .responses-wrapper {
    background: var(--panel-card);
    border-radius:10px;
    padding:14px;
    color:#cfe8df;
    overflow: visible; /* avoid internal scroll */
  }

  .responses-wrapper pre, .responses-wrapper code {
    background: transparent !important;
    border-radius: 6px;
    padding: 0;
    overflow: visible;
    color: #9be1cc;
    white-space: pre-wrap !important;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  .response-badges { display:flex; gap:8px; margin-bottom:10px; }
  .response-badges .badge { padding:6px 8px; border-radius:8px; background: rgba(255,255,255,0.03); color:#cfe8df; font-weight:700; font-size:12px; }

  .panel-empty { color: rgba(255,255,255,0.65); font-size:13px; padding:8px; }

  /* Responsividade */
  @media (max-width: 1200px) {
    .layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
    .code-panel { display: none; }
    .sidebar { position: relative; width:100%; }
    .content { padding: 20px; }
  }

  @media (max-width: 880px) {
    .sidebar { position: fixed; left:0; top:0; bottom:0; width:76%; max-width:380px; transform: translateX(-120%); transition:transform .22s; z-index:90; box-shadow:8px 0 32px rgba(2,6,23,0.12); }
    .sidebar.open { transform: translateX(0); }
  }

  .muted { color: var(--muted); font-size:12px; }
  .small { font-size:12px; color:var(--muted); }
</style>
</head>
<body>
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Sidebar">
    <div class="brand" aria-hidden="false">
      <img src="https://developers-sandbox.bvopen.com.br/sites/default/files/apidoc_specs/API-PIX-V1/assets/images/logo.png" alt="Banco BV" class="brand-logo" />
      <div>
        <div class="brand-text">Banco BV</div>
        <!-- subtítulo removido conforme solicitado -->
      </div>
    </div>

    <div class="search" aria-hidden="false">
      <input id="sidebar-search" type="search" placeholder="Buscar endpoints, tags, títulos..." aria-label="Buscar" />
    </div>

    <nav>
      <ul id="sidebar-menu" class="nav" aria-live="polite" aria-label="Lista de tags"></ul>
    </nav>
  </aside>

  <!-- CONTENT -->
  <main class="content" id="content">
    <div id="swagger-ui" class="swagger-ui"></div>
  </main>

  <!-- RIGHT PANEL -->
  <aside class="code-panel" id="code-panel" aria-live="polite" aria-atomic="true">
    <div class="endpoint-header">
      <div class="endpoint-title">
        <span id="code-method" class="method-pill default">OP</span>
        <div id="code-path" class="path-text">/caminho/exemplo</div>
      </div>
      <div class="controls">
        <button id="code-copy" class="btn" title="Copiar conteúdo do painel">Copiar</button>
        <button id="code-open" class="btn" title="Ir ao endpoint">Ir ao endpoint</button>
      </div>
    </div>

    <div id="code-view"><div class="panel-empty">Abra uma operação (clicando em um endpoint) para ver exemplos de respostas e códigos aqui.</div></div>
  </aside>

</div>

<!-- scripts -->
<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
/*
  Robust version:
  - Detects swagger rendering reliably.
  - Builds sidebar from H2 (sections) and tags.
  - Captures clicks anywhere on opblock-summary children.
  - More ways to find example/response blocks (robust fallback).
*/

const SWAGGER_URL = "https://camargofe.github.io/LwcDocumentacaoAPI/pix.yaml";
let lastClickedOpblock = null;
let sidebarBuilt = false;

// Initialize Swagger UI
SwaggerUIBundle({
  url: SWAGGER_URL,
  dom_id: "#swagger-ui",
  layout: "BaseLayout",
  deepLinking: true,
  presets: [SwaggerUIBundle.presets.apis]
});

// helpers
const $qs = (s, scope = document) => scope.querySelector(s);
const $qsa = (s, scope = document) => Array.from((scope || document).querySelectorAll(s));

function waitForSwaggerReady(timeout = 15000) {
  return new Promise((resolve, reject) => {
    const start = Date.now();
    (function check() {
      // prefer actual opblock summaries as a sign of readiness
      if ($qsa('.opblock-summary').length > 0 || $qsa('#swagger-ui h2').length > 0) return resolve();
      if (Date.now() - start > timeout) return reject(new Error('Swagger UI did not render in time'));
      requestAnimationFrame(check);
    })();
  });
}

/* Build sidebar: H2 sections + tags + ops (no "Seção" label) */
function buildSidebar() {
  const menu = document.getElementById('sidebar-menu');
  menu.innerHTML = '';

  // add H2 sections (if any)
  const h2s = $qsa('#swagger-ui h2');
  if (h2s.length) {
    const section = document.createElement('li');
    section.className = 'menu-section';
    section.innerHTML = `<div class="menu-heading"><div style="font-weight:700">Seções</div><div class="count">${h2s.length}</div></div>`;
    const list = document.createElement('div');
    list.style.display = 'flex';
    list.style.flexDirection = 'column';
    list.style.gap = '6px';

    h2s.forEach(h2 => {
      const text = (h2.textContent || '').trim();
      const btn = document.createElement('button');
      btn.className = 'tag-item';
      btn.type = 'button';
      btn.innerHTML = `<strong>${escapeHtml(text)}</strong>`;
      btn.addEventListener('click', () => {
        h2.scrollIntoView({ behavior: 'smooth', block: 'center' });
        Array.from(menu.querySelectorAll('.tag-item')).forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
      });
      list.appendChild(btn);
    });

    section.appendChild(list);
    menu.appendChild(section);
  }

  // collect tags and ops
  const tags = $qsa('.opblock-tag');
  tags.forEach(tagEl => {
    const titleSpan = tagEl.querySelector('h3 span');
    if (!titleSpan) return;
    const titleText = titleSpan.textContent.trim();

    const operations = tagEl.querySelectorAll('.opblock-summary');
    const count = operations.length;

    const li = document.createElement('li');
    li.className = 'menu-section';
    li.tabIndex = 0;

    const head = document.createElement('div');
    head.className = 'menu-heading';
    head.innerHTML = `<div style="font-weight:700">${escapeHtml(titleText)}</div><div class="count">${count}</div>`;
    li.appendChild(head);

    const opsContainer = document.createElement('div');
    opsContainer.className = 'ops';

    operations.forEach(op => {
      const method = op.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
      const path = op.querySelector('.opblock-summary-path')?.textContent?.trim() || '';
      const btn = document.createElement('button');
      btn.className = 'op-link';
      btn.type = 'button';
      // simplified: display path once
      btn.innerHTML = `<div class="method-pill-left method-${method.toLowerCase()}">${escapeHtml(method)}</div>
                       <div style="display:flex;flex-direction:column;align-items:flex-start;">
                         <div style="font-size:13px;color:#0b1220;">${escapeHtml(path)}</div>
                       </div>`;

      btn.addEventListener('click', () => {
        const opblock = op.closest('.opblock');
        if (!opblock) return;
        const summary = opblock.querySelector('.opblock-summary');
        if (summary) {
          summary.scrollIntoView({ behavior: 'smooth', block: 'center' });
          // trigger click on the actual summary to ensure Swagger opens it
          summary.click();
          lastClickedOpblock = opblock;
          // update after a small delay to let swagger render the open content
          setTimeout(() => updateRightPanel(opblock), 260);
        }
      });

      opsContainer.appendChild(btn);
    });

    li.appendChild(opsContainer);

    head.addEventListener('click', () => {
      const isActive = li.classList.contains('active');
      Array.from(menu.children).forEach(n => n.classList.remove('active'));
      if (!isActive) li.classList.add('active');
      tagEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    menu.appendChild(li);
  });

  sidebarBuilt = true;
}

/* wire search input */
function wireSearch() {
  const input = document.getElementById('sidebar-search');
  if (!input) return;
  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    const items = $qsa('#sidebar-menu .menu-section');
    items.forEach(item => {
      const heading = item.querySelector('.menu-heading > div')?.textContent?.toLowerCase() || '';
      const ops = Array.from(item.querySelectorAll('.op-link'));
      let anyOpMatch = false;
      ops.forEach(op => {
        const txt = op.textContent.toLowerCase();
        const match = q === '' || txt.includes(q);
        op.style.display = match ? '' : 'none';
        if (match) anyOpMatch = true;
      });
      const sectionMatch = q === '' || heading.includes(q);
      item.style.display = (sectionMatch || anyOpMatch) ? '' : 'none';
    });
  });
}

/* capture clicks robustly on opblock summaries (document level) */
function bindGlobalOpClicks() {
  document.addEventListener('click', (e) => {
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;
    lastClickedOpblock = opblock;
    // Slight delay to allow swagger's internal expansions to complete
    setTimeout(() => updateRightPanel(opblock), 200);
  });

  document.addEventListener('keydown', (e) => {
    if (e.key !== 'Enter' && e.key !== ' ') return;
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;
    lastClickedOpblock = opblock;
    setTimeout(() => updateRightPanel(opblock), 200);
  });
}

/* Observe DOM changes to rebuild sidebar when swagger renders new content */
function observeSwagger() {
  const uiRoot = document.querySelector('#swagger-ui');
  if (!uiRoot) return;
  const mo = new MutationObserver(mutations => {
    let shouldRebuild = false;
    for (const m of mutations) {
      if (m.addedNodes && m.addedNodes.length) shouldRebuild = true;
      if (m.type === 'attributes' && m.attributeName === 'class') {
        const t = m.target;
        if (t.classList && t.classList.contains('opblock') && t.classList.contains('is-open')) {
          const preferred = lastClickedOpblock || t;
          setTimeout(() => updateRightPanel(preferred), 80);
        }
      }
    }
    if (shouldRebuild) {
      clearTimeout(window._rebuild_sidebar);
      window._rebuild_sidebar = setTimeout(() => {
        try { buildSidebar(); wireSearch(); } catch(e){/*ignore*/ }
      }, 140);
    }
  });

  mo.observe(uiRoot, { subtree: true, childList: true, attributes: true, attributeFilter: ['class'] });
}

/* Stronger search for response/example blocks inside opblock */
function findResponsesWrapper(opblockEl) {
  if (!opblockEl) return null;

  const selectors = [
    '.responses-wrapper',
    '.responses-inner',
    '.opblock-body .responses-wrapper',
    '.opblock-body .responses-inner',
    '.opblock-body .responses',
    '.response',
    '.responses',
    '.examples-wrapper',
    '.example',
    '.opblock-description'
  ];

  for (const sel of selectors) {
    const node = opblockEl.querySelector(sel);
    if (node) return node;
  }

  // try to find any <pre> or <code> inside
  const pre = opblockEl.querySelector('pre, code, .highlight');
  if (pre) {
    const wrapper = document.createElement('div');
    wrapper.className = 'responses-wrapper';
    wrapper.appendChild(pre.cloneNode(true));
    return wrapper;
  }

  return null;
}

/* update right panel (robust) */
function updateRightPanel(preferredOpblock) {
  const panel = document.getElementById('code-view');
  if (!panel) return;
  panel.innerHTML = '';

  const opblock = preferredOpblock || lastClickedOpblock || document.querySelector('.opblock.is-open');
  if (!opblock) {
    panel.innerHTML = '<div class="panel-empty">Abra uma operação (clicando em um endpoint) para ver exemplos de respostas e códigos aqui.</div>';
    return;
  }

  const method = opblock.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
  const path = opblock.querySelector('.opblock-summary-path')?.textContent?.trim() || '';

  // header update
  const codeMethodEl = document.getElementById('code-method');
  codeMethodEl.className = 'method-pill ' + (method ? method.toLowerCase() : 'default');
  codeMethodEl.textContent = method || 'OP';
  document.getElementById('code-path').textContent = path || '';

  // find responses (with retries if not yet rendered)
  let responses = findResponsesWrapper(opblock);
  if (!responses && !opblock.classList.contains('is-open')) {
    panel.innerHTML = '<div class="panel-empty">Carregando exemplos...</div>';
    setTimeout(() => updateRightPanel(opblock), 240);
    return;
  }
  if (!responses) {
    panel.innerHTML = '<div class="panel-empty">Nenhuma resposta de exemplo encontrada para este endpoint.</div>';
    return;
  }

  // clone, sanitize and format
  const clone = responses.cloneNode(true);
  clone.classList.add('responses-wrapper');

  clone.querySelectorAll('.try-out, .execute, .btn, .model, .responses-request, .parameters, .tab, .tabbed').forEach(n => n.remove());

  // force wrapping & highlight classes
  clone.querySelectorAll('pre, code').forEach(el => {
    el.style.whiteSpace = 'pre-wrap';
    el.style.wordBreak = 'break-word';
    el.style.overflowWrap = 'anywhere';
    el.classList.add('hljs');
  });

  // badges
  const badges = document.createElement('div');
  badges.className = 'response-badges';
  badges.innerHTML = `<div class="badge">200</div><div class="badge">4xx</div><div class="badge">5xx</div>`;
  panel.appendChild(badges);
  panel.appendChild(clone);

  // highlight (safe)
  panel.querySelectorAll('pre code').forEach(block => {
    try { hljs.highlightElement(block); } catch(e) { /* ignore */ }
  });

  // wire copy button
  const copyBtn = document.getElementById('code-copy');
  copyBtn.onclick = async () => {
    let text = '';
    const codes = panel.querySelectorAll('pre code');
    if (codes.length) {
      text = Array.from(codes).map(c => c.innerText).join('\n\n---\n\n');
    } else {
      text = panel.innerText;
    }
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = 'Copiado ✓';
      setTimeout(() => copyBtn.textContent = 'Copiar', 1200);
    } catch {
      copyBtn.textContent = 'Erro';
      setTimeout(() => copyBtn.textContent = 'Copiar', 1200);
    }
  };

  // open button
  const openBtn = document.getElementById('code-open');
  openBtn.onclick = () => {
    opblock.scrollIntoView({ behavior: 'smooth', block: 'center' });
    const prev = opblock.style.boxShadow;
    opblock.style.boxShadow = '0 10px 36px rgba(14,165,233,0.12)';
    setTimeout(() => opblock.style.boxShadow = prev || '', 900);
  };
}

/* Escape html */
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}

/* Init: wait for swagger, then wire everything */
(async function init() {
  try {
    await waitForSwaggerReady();
  } catch (e) {
    console.warn('Swagger UI may be slow to render:', e);
  } finally {
    // attempt to build sidebar even if wait timed out
    try { buildSidebar(); } catch(e) { /* ignore */ }
    wireSearch();
    bindGlobalOpClicks();
    observeSwagger();

    // if something already open, populate right panel
    setTimeout(() => {
      const open = document.querySelector('.opblock.is-open');
      if (open) {
        lastClickedOpblock = open;
        updateRightPanel(open);
      } else {
        // try to pick first opblock-summary
        const first = document.querySelector('.opblock');
        if (first) {
          // do not auto-open, but prepare sidebar highlight if matching
          try { updateRightPanel(first); } catch(e){/*ignore*/ }
        }
      }
    }, 350);
  }
})();
</script>
</body>
</html>
