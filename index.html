<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PIX API - Documentação</title>

<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />

<style>
  /* Reset / box model */
  *,*::before,*::after { box-sizing: border-box; }
  html, body {
    margin: 0;
    min-height: 100%;
    height: 100%;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Helvetica;
    background: #f5f7fb;
    color: #0b1220;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x: hidden;
    overflow-y: auto;
  }

  :root{
    --sidebar-width: 260px;
    --right-width: 420px;
    --brand: #0f6fb2;
    --muted: #6b7280;
    --bg: #f5f7fb;
    --card: #ffffff;
    --panel-bg: #0f262a;
    --panel-card: #0b1416;
    --accent: #14b8a6;
    --page-gutter: 16px;
    --mobile-topbar-height: 56px;
  }

  /* ===== MOBILE TOPBAR (hidden on desktop) ===== */
  .mobile-topbar {
    display: none;
  }

  /* ===== LAYOUT ===== */
  .layout {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr var(--right-width);
    gap: 18px;
    min-height: calc(100vh - (var(--page-gutter) * 2));
    padding: var(--page-gutter);
    align-items: start;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    background: var(--card);
    border-right: 1px solid rgba(15,23,42,0.06);
    padding: 14px;
    display:flex;
    flex-direction:column;
    gap:12px;
    position: relative;
    max-height: calc(100vh - (var(--page-gutter) * 2));
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    min-width: 0;
    transition: transform .22s ease;
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .brand { display:flex; align-items:center; gap:10px; padding-bottom:6px; border-bottom:1px solid rgba(2,6,23,0.03); }
  .brand-logo { height:40px; width:auto; display:block; }
  .brand-text { font-weight:800; font-size:14px; }

  .sidebar .search input[type="search"] {
    width: 100%;
    padding: 9px 10px;
    border-radius: 8px;
    border: 1px solid rgba(2,6,23,0.06);
    background: #fbfdff;
    font-size: 13px;
    outline: none;
  }

  .nav { margin:0; padding:0; list-style:none; overflow:visible; }

  .menu-section { margin-bottom:8px; }

  .menu-heading { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px; color:var(--muted); font-weight:600; font-size:13px; padding:6px 8px; border-radius:6px; cursor:pointer;}
  .menu-heading:hover { background: rgba(15,23,42,0.03); }
  .menu-heading .title { color:#1b5db9; font-weight:600; font-size:13px; }
  .menu-heading .caret { width:14px; height:14px; display:inline-flex; align-items:center; justify-content:center; color:var(--muted); transform:rotate(0deg); transition:transform .18s; font-size:12px; }
  .menu-section.expanded .menu-heading .caret { transform: rotate(90deg); color: var(--brand); }

  .ops { display:none; margin-top:6px; padding-left:6px; display:flex; flex-direction:column; gap:6px; }
  .menu-section.expanded .ops { display:flex; }

  .op-link {
    display:flex;
    gap:10px;
    align-items:center;
    padding:6px 8px;
    border-radius:6px;
    font-size:13px;
    color:#374151;
    background: transparent;
    border: none;
    text-align:left;
    cursor:pointer;
  }
  .op-link:hover { background: rgba(15,23,42,0.03); color:#0b1220; }
  .op-link .method-pill-left { padding:5px 8px; border-radius:6px; font-weight:800; font-size:11px; color:#fff; min-width:44px; text-align:center; }
  .op-link .path { color:#1b5db9; font-size:13px; text-align:left; white-space:normal; }

  .method-get { background:#16a34a; }
  .method-post { background:#2563eb; }
  .method-patch { background:#d97706; }
  .method-put { background:#f59e0b; color:#0b1220; }
  .method-delete { background:#ef4444; }

  .op-link.active { background: rgba(15,23,42,0.04); box-shadow: inset 3px 0 0 var(--brand); color:#0b1220; font-weight:700; }

  /* ===== CONTENT (central) ===== */
  .content {
    min-width: 0;
    max-height: calc(100vh - (var(--page-gutter) * 2));
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  .swagger-ui {
    background: var(--card);
    border-radius: 10px;
    padding: 18px;
    box-shadow: 0 8px 24px rgba(9,30,66,0.06);
    color: #0b1220;
    width: 100%;
    min-width: 0;
    max-height: calc(100vh - (var(--page-gutter) * 2) - 12px);
    overflow: auto;
  }

  /* ===== RIGHT PANEL (desktop) ===== */
  .code-panel {
    background: var(--panel-bg);
    border-left: 1px solid rgba(255,255,255,0.03);
    padding: 12px;
    color: #e6fbf4;
    display:flex;
    flex-direction:column;
    gap:10px;
    position: sticky;
    top: var(--page-gutter);
    align-self: start;
    max-height: calc(100vh - (var(--page-gutter) * 2));
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    min-width: 0;
    border-radius: 6px;
  }

  .panel-header { background: rgba(0,0,0,0.28); padding: 8px 12px; border-radius: 6px; display:flex; align-items:center; gap:10px; color: #fff;}
  .panel-header .try { background: rgba(255,255,255,0.05); color: #dff6f2; padding: 4px 8px; border-radius:4px; font-weight:700; font-size:12px; text-transform:lowercase; }
  .panel-header .method-pill { padding:6px 10px; border-radius:6px; font-weight:800; font-size:12px; color:#fff; }
  .panel-header .path { color:#e6fbf4; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size:13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  .section-title { color: #e6fbf4; font-size:16px; font-weight:700; margin: 6px 0 4px; }

  .response-badges { display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
  .response-badges .badge { background:#101b1b; color:#9be1cc; padding:6px 10px; border-radius:6px; font-weight:700; cursor:pointer; border: 1px solid rgba(255,255,255,0.02); }

  .code-card { background: var(--panel-card); border-radius:6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.03); }
  .code-card .top-row { display:flex; justify-content:space-between; align-items:center; padding: 10px 12px; background: rgba(0,0,0,0.08); }
  .code-card .content-type { color:#9bdacb; font-size:13px; }
  .code-card .card-controls { display:flex; gap:12px; align-items:center; color:#cfe8df; font-size:13px; }
  .code-card .card-controls button { background: transparent; border: none; color: #cfe8df; cursor:pointer; padding: 4px 8px; border-radius:4px; font-weight:700; }
  .code-card .code-area { padding: 12px; color: #9be1cc; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size: 13px; white-space: pre-wrap; word-break: break-word; max-height: 320px; overflow: auto; }
  .code-card .code-area pre { margin:0; background:transparent; color:inherit; }
  .panel-empty { color: rgba(255,255,255,0.65); font-size:13px; padding:8px; }

  /* ===== MOBILE: responsive adjustments + toggles ===== */
  @media (max-width: 1200px) {
    /* show mobile topbar */
    .mobile-topbar { display:flex; position:fixed; top:0; left:0; right:0; height:var(--mobile-topbar-height); align-items:center; gap:12px; padding: 0 12px; background:#ffffff; border-bottom: 1px solid rgba(15,23,42,0.04); z-index:220; }
    .mobile-topbar .hamburger { background:transparent; border:none; font-size:20px; padding:6px; cursor:pointer; }
    .mobile-topbar .title { font-weight:700; color:#0b1220; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:60%; }
    .mobile-topbar .panel-btn { margin-left:auto; background:transparent; border: none; font-weight:700; color:var(--brand); cursor:pointer; padding:6px 8px; }

    /* push layout down to avoid overlapping topbar */
    .layout { padding-top: calc(var(--page-gutter) + var(--mobile-topbar-height)); grid-template-columns: 1fr; grid-template-rows: auto 1fr; gap: 12px; }

    /* sidebar becomes overlay panel */
    .sidebar {
      position: fixed;
      top: var(--mobile-topbar-height);
      left: 0;
      bottom: 0;
      width: 76%;
      max-width: 360px;
      transform: translateX(-120%);
      z-index: 230;
      box-shadow: 8px 0 32px rgba(2,6,23,0.12);
      border-right: none;
      background: var(--card);
    }
    .sidebar.open { transform: translateX(0); }

    /* backdrop when sidebar open */
    #sidebar-backdrop { display:block; position:fixed; inset: var(--mobile-topbar-height) 0 0 0; background: rgba(2,6,23,0.28); opacity:0; pointer-events:none; transition:opacity .18s; z-index:210; }
    #sidebar-backdrop.visible { opacity:1; pointer-events:auto; }

    /* code-panel hidden on mobile by default; can be opened as drawer */
    .code-panel { display: none; position: fixed; bottom:0; left:0; right:0; height: 60vh; z-index: 240; border-radius: 12px 12px 0 0; }
    .code-panel.mobile-open { display:flex; animation: slideUp .18s ease forwards; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    /* adjust search to be full width and compact */
    .sidebar .search input[type="search"] { padding:8px; font-size:14px; }
  }

  /* mobile close button inside code panel */
  .code-panel .mobile-close {
    display:none;
  }
  @media (max-width: 1200px) {
    .code-panel .mobile-close { display:inline-block; background:transparent; border:none; color:#cfe8df; font-weight:700; cursor:pointer; margin-left:auto; }
  }

  /* small screens narrower cleanup */
  @media (max-width: 880px) {
    .layout { padding-top: calc(var(--page-gutter) + var(--mobile-topbar-height)); }
  }

  .muted { color: var(--muted); font-size:12px; }
  .small { font-size:12px; color:var(--muted); }

  .swagger-ui .opblock .opblock-body { overflow: visible !important; }
</style>
</head>
<body>
  <!-- MOBILE TOPBAR -->
  <div class="mobile-topbar" role="toolbar" aria-hidden="true">
    <button id="toggle-sidebar-btn" class="hamburger" aria-label="Abrir menu">☰</button>
    <div class="title">PIX API - Documentação</div>
    <button id="open-panel-btn" class="panel-btn" aria-label="Abrir painel de exemplos">Exemplos</button>
  </div>

  <!-- BACKDROP for sidebar on mobile -->
  <div id="sidebar-backdrop" aria-hidden="true"></div>

  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Sidebar">
      <div class="brand" aria-hidden="false">
        <img src="https://developers-sandbox.bvopen.com.br/sites/default/files/apidoc_specs/API-PIX-V1/assets/images/logo.png" alt="Banco BV" class="brand-logo" />
        <div>
          <div class="brand-text">Banco BV</div>
        </div>
      </div>

      <div class="search" aria-hidden="false">
        <input id="sidebar-search" type="search" placeholder="Buscar endpoints, tags, títulos..." aria-label="Buscar" />
      </div>

      <nav>
        <ul id="sidebar-menu" class="nav" aria-live="polite" aria-label="Lista de tags"></ul>
      </nav>
    </aside>

    <!-- CONTENT -->
    <main class="content" id="content">
      <div id="swagger-ui" class="swagger-ui"></div>
    </main>

    <!-- RIGHT PANEL -->
    <aside class="code-panel" id="code-panel" aria-live="polite" aria-atomic="true">
      <div class="panel-header" id="panel-header" aria-hidden="false">
        <div class="try">try</div>
        <div id="code-method" class="method-pill default">OP</div>
        <div id="code-path" class="path">/caminho/exemplo</div>
        <button class="mobile-close" id="close-panel-btn" aria-label="Fechar painel">Fechar</button>
      </div>

      <div>
        <div class="section-title">Response samples</div>
        <div id="response-badges" class="response-badges" aria-hidden="false"></div>

        <div class="code-card" id="response-card" style="margin-top:8px;">
          <div class="top-row">
            <div class="content-type" id="response-content-type">application/json</div>
            <div class="card-controls" id="response-controls">
              <button id="response-copy">Copy</button>
              <button id="response-expand">Expand all</button>
              <button id="response-collapse">Collapse all</button>
            </div>
          </div>
          <div class="code-area" id="response-code-area"><pre><code></code></pre></div>
        </div>
      </div>
    </aside>

  </div>

<!-- scripts -->
<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
/* Mobile-friendly enhancement added to your final working version:
   - hamburger toggles sidebar overlay on small screens
   - backdrop closes sidebar
   - "Exemplos" button opens code-panel as bottom drawer on mobile
   - close button inside code-panel for mobile
   - existing behavior preserved on desktop
*/

const SWAGGER_URL = "https://camargofe.github.io/LwcDocumentacaoAPI/pix.yaml";
let lastClickedOpblock = null;
let responseExamples = [];

/* Swagger UI init */
SwaggerUIBundle({
  url: SWAGGER_URL,
  dom_id: "#swagger-ui",
  layout: "BaseLayout",
  deepLinking: true,
  presets: [SwaggerUIBundle.presets.apis]
});

// helpers
const $qsa = (s, scope = document) => Array.from((scope || document).querySelectorAll(s));
const $qs = (s, scope = document) => (scope || document).querySelector(s);

function waitForSwaggerReady(timeout = 15000) {
  return new Promise((resolve, reject) => {
    const start = Date.now();
    (function check() {
      if ($qsa('.opblock-summary').length > 0 || $qsa('#swagger-ui h2').length > 0) return resolve();
      if (Date.now() - start > timeout) return reject(new Error('Swagger UI did not render in time'));
      requestAnimationFrame(check);
    })();
  });
}

/* remove zeros helper (keeps previous behavior) */
function removeZeroCounts() {
  const menu = document.getElementById('sidebar-menu');
  if (!menu) return;
  const candidates = Array.from(menu.querySelectorAll('*')).filter(el => {
    const txt = (el.textContent || '').trim();
    return el.children.length === 0 && txt === '0';
  });
  candidates.forEach(n => n.remove());
}

/* Build sidebar adapted for compact mobile-friendly layout (keeps original behavior) */
function buildSidebar() {
  const menu = document.getElementById('sidebar-menu');
  if (!menu) return;
  menu.innerHTML = '';

  // sections (h2)
  const h2s = $qsa('#swagger-ui h2');
  if (h2s.length) {
    const section = document.createElement('li');
    section.className = 'menu-section';
    section.innerHTML = `<div class="menu-heading"><div class="title">Seções</div><div class="count">${h2s.length}</div><div class="caret">▸</div></div>`;
    const list = document.createElement('div');
    list.className = 'ops';
    list.style.display = 'none';
    list.style.paddingLeft = '6px';

    h2s.forEach(h2 => {
      const text = (h2.textContent || '').trim();
      const btn = document.createElement('button');
      btn.className = 'op-link';
      btn.type = 'button';
      btn.innerHTML = `<div class="method-pill-left" style="visibility:hidden"></div><div class="path">${escapeHtml(text)}</div>`;
      btn.addEventListener('click', () => {
        h2.scrollIntoView({ behavior: 'smooth', block: 'center' });
        Array.from(menu.querySelectorAll('.op-link')).forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
        // close mobile sidebar to show content
        closeSidebarIfMobile();
      });
      list.appendChild(btn);
    });

    section.appendChild(list);
    const head = section.querySelector('.menu-heading');
    head.addEventListener('click', (e) => {
      const expanded = section.classList.toggle('expanded');
      list.style.display = expanded ? 'flex' : 'none';
      e.stopPropagation();
    });

    menu.appendChild(section);
  }

  // tags + ops
  const tags = $qsa('.opblock-tag');
  tags.forEach(tagEl => {
    const titleSpan = tagEl.querySelector('h3 span');
    if (!titleSpan) return;
    const titleText = titleSpan.textContent.trim();

    const operations = tagEl.querySelectorAll('.opblock-summary');

    const li = document.createElement('li');
    li.className = 'menu-section';

    const head = document.createElement('div');
    head.className = 'menu-heading';
    head.innerHTML = `<div class="title">${escapeHtml(titleText)}</div><div class="count">${operations.length}</div><div class="caret">▸</div>`;
    li.appendChild(head);

    const opsContainer = document.createElement('div');
    opsContainer.className = 'ops';
    opsContainer.style.display = 'none';

    operations.forEach(op => {
      const method = op.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
      const path = op.querySelector('.opblock-summary-path')?.textContent?.trim() || '';
      const btn = document.createElement('button');
      btn.className = 'op-link';
      btn.type = 'button';
      const mclass = 'method-' + (method.toLowerCase() || 'get').replace(' ', '-');
      btn.innerHTML = `<div class="method-pill-left ${mclass}">${escapeHtml(method || '')}</div>
                       <div class="path">${escapeHtml(path)}</div>`;

      btn.addEventListener('click', () => {
        const opblock = op.closest('.opblock');
        if (!opblock) return;
        const summary = opblock.querySelector('.opblock-summary');
        if (summary) {
          if (!li.classList.contains('expanded')) {
            li.classList.add('expanded');
            opsContainer.style.display = 'flex';
          }
          summary.scrollIntoView({ behavior: 'smooth', block: 'center' });
          summary.click();
          lastClickedOpblock = opblock;
          setTimeout(() => {
            updateRightPanel(opblock);
            Array.from(opsContainer.querySelectorAll('.op-link')).forEach(n => n.classList.remove('active'));
            btn.classList.add('active');
            closeSidebarIfMobile();
          }, 260);
        }
      });

      opsContainer.appendChild(btn);
    });

    head.addEventListener('click', (e) => {
      const isActive = li.classList.toggle('expanded');
      opsContainer.style.display = isActive ? 'flex' : 'none';
      e.stopPropagation();
    });

    li.appendChild(opsContainer);
    menu.appendChild(li);
  });

  removeZeroCounts();
}

/* Search */
function wireSearch() {
  const input = document.getElementById('sidebar-search');
  if (!input) return;
  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    const items = $qsa('#sidebar-menu .menu-section');
    items.forEach(item => {
      const heading = item.querySelector('.menu-heading > .title')?.textContent?.toLowerCase() || '';
      const ops = Array.from(item.querySelectorAll('.op-link'));
      let anyOpMatch = false;
      ops.forEach(op => {
        const txt = op.textContent.toLowerCase();
        const match = q === '' || txt.includes(q);
        op.style.display = match ? '' : 'none';
        if (match) anyOpMatch = true;
      });
      const sectionMatch = q === '' || heading.includes(q);
      item.style.display = (sectionMatch || anyOpMatch) ? '' : 'none';
      if (anyOpMatch) {
        item.classList.add('expanded');
        const opsEl = item.querySelector('.ops');
        if (opsEl) opsEl.style.display = 'flex';
      }
    });
    removeZeroCounts();
  });
}

/* Click handlers for swagger opblocks */
function bindGlobalOpClicks() {
  document.addEventListener('click', (e) => {
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;
    lastClickedOpblock = opblock;
    setTimeout(() => updateRightPanel(opblock), 200);
  });

  document.addEventListener('keydown', (e) => {
    if (e.key !== 'Enter' && e.key !== ' ') return;
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;
    lastClickedOpblock = opblock;
    setTimeout(() => updateRightPanel(opblock), 200);
  });
}

/* Observe mutations to rebuild sidebar when needed */
function observeSwagger() {
  const uiRoot = document.querySelector('#swagger-ui');
  if (!uiRoot) return;
  const mo = new MutationObserver(mutations => {
    let shouldRebuild = false;
    for (const m of mutations) {
      if (m.addedNodes && m.addedNodes.length) shouldRebuild = true;
      if (m.type === 'attributes' && m.attributeName === 'class') {
        const t = m.target;
        if (t.classList && t.classList.contains('opblock') && t.classList.contains('is-open')) {
          const preferred = lastClickedOpblock || t;
          setTimeout(() => updateRightPanel(preferred), 80);
        }
      }
    }
    if (shouldRebuild) {
      clearTimeout(window._rebuild_sidebar);
      window._rebuild_sidebar = setTimeout(() => {
        try { buildSidebar(); wireSearch(); removeZeroCounts(); } catch(e){/*ignore*/ }
      }, 140);
    }
  });

  mo.observe(uiRoot, { subtree: true, childList: true, attributes: true, attributeFilter: ['class'] });
}

/* Response extraction helpers kept same as final */
function findResponsesWrapper(opblockEl) {
  if (!opblockEl) return null;
  const selectors = [
    '.responses-wrapper',
    '.responses-inner',
    '.opblock-body .responses-wrapper',
    '.opblock-body .responses-inner',
    '.opblock-body .responses',
    '.response',
    '.responses',
    '.examples-wrapper',
    '.example',
    '.opblock-description'
  ];
  for (const sel of selectors) {
    const node = opblockEl.querySelector(sel);
    if (node) return node;
  }
  const pre = opblockEl.querySelector('pre, code, .highlight');
  if (pre) {
    const wrapper = document.createElement('div');
    wrapper.className = 'responses-wrapper';
    wrapper.appendChild(pre.cloneNode(true));
    return wrapper;
  }
  return null;
}

function extractResponseExamples(opblock) {
  const examples = [];
  const responseNodes = Array.from(opblock.querySelectorAll('.responses-wrapper .response, .response'));
  for (const node of responseNodes) {
    let status = (node.querySelector('.response-col_status')?.textContent ||
                  node.querySelector('.response__status')?.textContent ||
                  node.querySelector('.response-status-code')?.textContent ||
                  node.querySelector('h4')?.textContent ||
                  '').trim();
    const m = status.match(/(\d{3})/);
    status = m ? m[1] : (status || '200');
    const pre = node.querySelector('pre, code, .microlight');
    const text = pre ? pre.innerText.trim() : null;
    if (text) examples.push({ status, contentType: 'application/json', text });
  }

  if (examples.length === 0) {
    const pres = Array.from(opblock.querySelectorAll('.responses-wrapper pre, .responses-wrapper code, pre, code'));
    pres.forEach((p, idx) => {
      const txt = p.innerText.trim();
      if (txt) examples.push({ status: (idx === 0 ? '200' : `ex${idx}`), contentType: 'application/json', text: txt });
    });
  }

  const seen = new Set();
  return examples.filter(e => {
    if (seen.has(e.status)) return false;
    seen.add(e.status);
    return true;
  });
}

/* Update right panel (desktop) and also used for mobile drawer content */
function updateRightPanel(preferredOpblock) {
  const methodEl = document.getElementById('code-method');
  const pathEl = document.getElementById('code-path');
  const badgesContainer = document.getElementById('response-badges');
  const contentTypeEl = document.getElementById('response-content-type');
  const codeAreaEl = document.getElementById('response-code-area');

  badgesContainer.innerHTML = '';
  codeAreaEl.querySelector('pre code').textContent = '';

  const opblock = preferredOpblock || lastClickedOpblock || document.querySelector('.opblock.is-open');
  if (!opblock) {
    methodEl.className = 'method-pill default';
    methodEl.textContent = 'OP';
    pathEl.textContent = '';
    return;
  }

  const method = opblock.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
  const path = opblock.querySelector('.opblock-summary-path')?.textContent?.trim() || '';
  methodEl.className = 'method-pill ' + (method ? method.toLowerCase() : 'default');
  methodEl.textContent = method || 'OP';
  pathEl.textContent = path || '';

  let examples = [];
  try { examples = extractResponseExamples(opblock); } catch (e) { examples = []; }

  if (examples.length === 0) {
    contentTypeEl.textContent = 'application/json';
    codeAreaEl.querySelector('pre code').textContent = '// Nenhum exemplo de resposta encontrado.';
    return;
  }

  examples.forEach((ex, idx) => {
    const b = document.createElement('button');
    b.type = 'button';
    b.className = 'badge';
    b.textContent = ex.status;
    b.addEventListener('click', () => {
      Array.from(badgesContainer.children).forEach(c => c.classList.remove('active'));
      b.classList.add('active');
      contentTypeEl.textContent = ex.contentType || 'application/json';
      codeAreaEl.querySelector('pre code').textContent = ex.text || '';
      try { hljs.highlightElement(codeAreaEl.querySelector('pre code')); } catch(e) {/*ignore*/}
    });
    if (idx === 0) b.classList.add('active');
    badgesContainer.appendChild(b);
  });

  const first = examples[0];
  contentTypeEl.textContent = first.contentType || 'application/json';
  codeAreaEl.querySelector('pre code').textContent = first.text || '';
  try { hljs.highlightElement(codeAreaEl.querySelector('pre code')); } catch(e) {/*ignore*/}
}

/* Escape helper */
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}

/* ---- Mobile UI controls ---- */
const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
const sidebarEl = document.getElementById('sidebar');
const backdrop = document.getElementById('sidebar-backdrop');
const openPanelBtn = document.getElementById('open-panel-btn');
const codePanel = document.getElementById('code-panel');
const closePanelBtn = document.getElementById('close-panel-btn');

function openSidebar() {
  sidebarEl.classList.add('open');
  backdrop.classList.add('visible');
}
function closeSidebar() {
  sidebarEl.classList.remove('open');
  backdrop.classList.remove('visible');
}
function closeSidebarIfMobile() {
  if (window.matchMedia('(max-width: 1200px)').matches) closeSidebar();
}

toggleSidebarBtn?.addEventListener('click', (e) => {
  if (sidebarEl.classList.contains('open')) closeSidebar();
  else openSidebar();
});
backdrop?.addEventListener('click', closeSidebar);

openPanelBtn?.addEventListener('click', () => {
  // open code panel as mobile drawer
  codePanel.classList.add('mobile-open');
  // if sidebar open on mobile close it for clarity
  closeSidebar();
});
closePanelBtn?.addEventListener('click', () => {
  codePanel.classList.remove('mobile-open');
});

// also close mobile drawer when clicking outside (on backdrop area)
document.addEventListener('click', (e) => {
  if (codePanel.classList.contains('mobile-open')) {
    const inside = e.target.closest('#code-panel');
    const isPanelBtn = e.target.closest('#open-panel-btn');
    if (!inside && !isPanelBtn && window.matchMedia('(max-width:1200px)').matches) {
      codePanel.classList.remove('mobile-open');
    }
  }
});

/* Init */
(async function init() {
  try {
    await waitForSwaggerReady();
  } catch (e) {
    console.warn('Swagger UI may be slow to render:', e);
  } finally {
    try { buildSidebar(); } catch(e){/*ignore*/ }
    try { removeZeroCounts(); } catch(e){/*ignore*/ }
    wireSearch();
    bindGlobalOpClicks();
    observeSwagger();

    // ensure right panel populated if something already open
    setTimeout(() => {
      const open = document.querySelector('.opblock.is-open');
      if (open) {
        lastClickedOpblock = open;
        updateRightPanel(open);
      }
    }, 350);

    // responsive: close sidebar when rotating/resizing to desktop
    window.addEventListener('resize', () => {
      if (!window.matchMedia('(max-width:1200px)').matches) {
        // ensure sidebar visibility reset
        sidebarEl.classList.remove('open');
        backdrop.classList.remove('visible');
        codePanel.classList.remove('mobile-open');
      }
    });
  }
})();
</script>
</body>
</html>
