<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PIX API - Banco BV</title>

<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />

<style>
  :root{
    --sidebar-width: 300px;
    --right-width: 520px;
    --gutter: 8px;
    --brand: #002f6c;
    --muted: #6b7280;
    --bg: #f5f7fa;
  }

  html, body {
    margin: 0;
    height: 100%;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg);
    color: #0b1220;
    -webkit-font-smoothing:antialiased;
  }

  /* ===== LAYOUT ===== */
  .layout {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr;
    height: 100vh;
    gap: 0;
    overflow: hidden;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    background: #ffffff;
    border-right: 1px solid #e6e9ee;
    padding: 16px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .sidebar .header {
    display:flex;
    align-items:center;
    gap:12px;
  }

  .sidebar h3 {
    font-size: 15px;
    color: var(--brand);
    margin: 0;
    letter-spacing: -0.2px;
  }

  .sidebar .search {
    display:flex;
    gap:8px;
    align-items:center;
  }

  .sidebar input[type="search"] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #e6e9ee;
    background: #fbfdff;
    font-size: 13px;
  }

  .tag-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .tag-item {
    display:flex;
    justify-content: space-between;
    align-items:center;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: background .12s, transform .06s;
    font-size: 13px;
    color: #0b1220;
  }

  .tag-item .left {
    display:flex;
    gap:8px;
    align-items:center;
  }

  .tag-item:hover { background: rgba(0,47,108,0.06); transform: translateY(-1px); }
  .tag-item.active { background: linear-gradient(90deg,#e9f1ff, #fbfdff); border: 1px solid rgba(0,47,108,0.06); box-shadow: 0 1px 0 rgba(0,0,0,0.02) inset; }

  .tag-count {
    background: rgba(0,47,108,0.08);
    color: var(--brand);
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 12px;
  }

  .tag-meta {
    color: var(--muted);
    font-size: 12px;
    margin-top: 6px;
  }

  .sidebar-footer {
    margin-top: auto;
    font-size: 12px;
    color: var(--muted);
  }

  /* ===== CONTEÚDO CENTRAL ===== */
  .content {
    background: #ffffff;
    overflow-y: auto;
    position: relative;
  }

  .swagger-ui {
    padding: 18px;
  }

  /* Floating control to toggle sidebar on small screens */
  .mobile-controls {
    display:none;
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 80;
  }

  .mobile-btn {
    display:inline-flex;
    align-items:center;
    gap:8px;
    background: #fff;
    border-radius: 999px;
    padding: 8px 12px;
    border: 1px solid #e6e9ee;
    box-shadow: 0 6px 20px rgba(16,24,40,0.06);
    cursor: pointer;
  }

  /* ===== PAINEL DIREITO (OVERLAY) =====
     Changed to overlay so cloned responses open on the right overlaying the content (not expanding UI on the left) */
  .code-panel {
    position: absolute;
    right: 20px;
    top: 20px;
    bottom: 20px;
    width: var(--right-width);
    max-width: calc(100% - 64px);
    background: linear-gradient(180deg,#071021,#071422);
    border-radius: 10px;
    padding: 16px;
    overflow: auto;
    color: #fff;
    display:flex;
    flex-direction: column;
    gap: 12px;
    box-shadow: 0 10px 40px rgba(2,6,23,0.4);
    z-index: 80;
    border: 1px solid rgba(255,255,255,0.04);
    transform: translateY(0);
    transition: transform .18s ease, opacity .18s ease;
  }

  .code-panel.hidden { opacity: 0; pointer-events: none; transform: translateY(6px); }

  .code-panel .endpoint-header {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 6px;
    display:flex;
    justify-content:space-between;
    gap: 12px;
    align-items:center;
  }

  .method-pill {
    display:inline-block;
    padding: 6px 10px;
    border-radius: 8px;
    font-weight:700;
    font-size: 12px;
    color: #fff;
  }

  .method-pill.get { background: #16a34a; }
  .method-pill.post { background: #0ea5e9; }
  .method-pill.put { background: #f59e0b; color:#0b1220; }
  .method-pill.delete { background: #ef4444; }
  .method-pill.default { background: rgba(255,255,255,0.06); }

  .path-text { color: rgba(255,255,255,0.95); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; }

  .right-body {
    display:flex;
    gap:10px;
    flex-direction: column;
    overflow: auto;
  }

  .code-panel .controls {
    display:flex;
    gap:8px;
    align-items:center;
  }

  .btn {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.04);
    color: #fff;
    padding: 6px 8px;
    border-radius: 8px;
    cursor:pointer;
    font-size: 13px;
  }

  .btn.primary {
    background: linear-gradient(90deg,#0ea5e9,#2dd4bf);
    color: #06202a;
    font-weight:700;
    border: none;
  }

  .responses-wrapper pre {
    background: #020617 !important;
    border-radius: 6px;
    padding: 12px;
    overflow: auto;
  }

  .panel-empty {
    color: rgba(255,255,255,0.6);
    font-size: 13px;
    padding: 10px 4px;
  }

  .code-panel .panel-close {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.7);
    cursor: pointer;
    font-size: 14px;
  }

  /* Responsive behavior */
  @media (max-width: 1200px) {
    .layout {
      grid-template-columns: 260px 1fr;
    }
    .mobile-controls { display:block; }
  }

  @media (max-width: 880px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 76%;
      max-width: 380px;
      transform: translateX(-120%);
      transition: transform .22s ease;
      z-index: 90;
      box-shadow: 8px 0 32px rgba(2,6,23,0.12);
    }
    .sidebar.open { transform: translateX(0); }
    .content { padding-top: 62px; }
    .code-panel {
      left: 8px;
      right: 8px;
      top: 70px;
      bottom: 16px;
      width: auto;
      max-width: calc(100% - 32px);
    }
  }
</style>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="header">
      <div>
        <h3>Documentação</h3>
        <div style="font-size:12px;color:var(--muted)">PIX API - Banco BV</div>
      </div>
      <button class="collapse-toggle" id="close-sidebar" aria-label="Fechar sidebar">Fechar</button>
    </div>

    <div class="search">
      <input id="sidebar-search" type="search" placeholder="Buscar tag, caminho ou operação..." aria-label="Buscar documentação">
    </div>

    <ul id="sidebar-menu" class="tag-list" aria-live="polite" aria-label="Lista de tags">
      <!-- Tags inserted here -->
    </ul>

    <div class="tag-meta" id="tag-meta">
      Selecione uma tag para navegar rapidamente para os endpoints relacionados.
    </div>

    <div class="sidebar-footer">
      Open Banking · <strong>openbanking@bv.com.br</strong>
    </div>
  </aside>

  <!-- CONTEÚDO -->
  <main class="content" id="content">
    <div class="mobile-controls" id="mobile-controls">
      <button class="mobile-btn" id="mobile-open-sidebar" aria-label="Abrir sidebar">Menu</button>
    </div>

    <div id="swagger-ui" class="swagger-ui"></div>
  </main>

  <!-- PAINEL DIREITO (overlay) -->
  <aside class="code-panel hidden" id="code-panel" aria-live="polite" aria-atomic="true">
    <div class="endpoint-header">
      <div id="code-header-left">
        <span id="code-method" class="method-pill default">OP</span>
        <span id="code-path" class="path-text" style="margin-left:8px">/caminho/exemplo</span>
      </div>
      <div class="controls">
        <button class="btn" id="code-copy">Copiar</button>
        <button class="btn" id="code-open-in-swagger">Ir ao endpoint</button>
        <button class="panel-close" id="code-close" title="Fechar painel">✕</button>
      </div>
    </div>

    <div id="code-view">
      <div class="panel-empty">Abra uma operação (clicando em um endpoint) para ver exemplos de respostas e códigos aqui.</div>
    </div>
  </aside>

</div>

<!-- External scripts -->
<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
/*
  Alterações principais para resolver o problema solicitado:
  - O painel de código foi convertido em overlay (aberta à direita) para "sobrescrever" a visualização principal ao abrir um endpoint.
  - Interceptamos o clique em .opblock-summary e impedimos a ação padrão do Swagger (que expande o bloco para a esquerda).
    Em vez disso, mostramos os códigos/respostas clonados no painel direito (overlay).
  - Mantive e reforcei a acessibilidade (teclado), busca e a sidebar melhorada do código anterior.
  - O painel de código tem botão de fechar e botão para ir ao endpoint (desloca/realça o bloco no conteúdo).
*/

const SWAGGER_URL = "https://camargofe.github.io/LwcDocumentacaoAPI/pix.yaml";

/* Create Swagger UI */
SwaggerUIBundle({
  url: SWAGGER_URL,
  dom_id: "#swagger-ui",
  layout: "BaseLayout",
  deepLinking: true,
  presets: [SwaggerUIBundle.presets.apis]
});

/* Utility */
function $qs(selector, scope=document) { return scope.querySelector(selector); }
function $qsa(selector, scope=document) { return Array.from(scope.querySelectorAll(selector)); }

/* Wait until opblock-tag elements are present (injected by Swagger UI) */
function waitForSwaggerReady(timeout = 8000) {
  return new Promise((resolve, reject) => {
    const start = Date.now();
    const check = () => {
      if ($qsa('.opblock-tag').length > 0) return resolve();
      if (Date.now() - start > timeout) return reject(new Error('Timeout waiting Swagger UI'));
      requestAnimationFrame(check);
    };
    check();
  });
}

/* Build enhanced sidebar from DOM tags */
function buildSidebar() {
  const menu = document.getElementById("sidebar-menu");
  menu.innerHTML = "";

  const tags = $qsa(".opblock-tag");
  tags.forEach(tagEl => {
    const titleSpan = tagEl.querySelector("h3 span");
    const titleText = titleSpan ? titleSpan.textContent.trim() : 'Sem nome';

    // Count operations inside this tag
    const operations = tagEl.querySelectorAll(".opblock-summary");
    const count = operations.length;

    const li = document.createElement("li");
    li.className = "tag-item";
    li.tabIndex = 0;
    li.title = titleText;
    li.dataset.tag = titleText;

    const left = document.createElement("div");
    left.className = "left";
    left.innerHTML = `<strong>${titleText}</strong>`;
    const right = document.createElement("div");
    right.style.display = "flex";
    right.style.alignItems = "center";
    right.innerHTML = `<span class="tag-count">${count}</span>`;

    li.appendChild(left);
    li.appendChild(right);

    li.onclick = () => {
      // Scroll the tag element into view
      tagEl.scrollIntoView({ behavior: "smooth", block: "center" });

      // Open the overlay showing the first operation of the tag
      const firstOp = tagEl.querySelector(".opblock");
      if (firstOp) {
        openRightPanelFor(firstOp);
      }
      setActiveTag(titleText);
    };

    // keyboard accessible
    li.onkeydown = (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.click(); }
    };

    menu.appendChild(li);
  });

  // Search behavior
  const search = document.getElementById("sidebar-search");
  search.oninput = () => {
    const q = search.value.trim().toLowerCase();
    const items = Array.from(menu.children);
    items.forEach(item => {
      const tag = item.dataset.tag.toLowerCase();
      if (!q || tag.includes(q)) {
        item.style.display = "";
      } else {
        item.style.display = "none";
      }
    });
  };
}

/* Highlight active tag based on which opblock is mostly visible in center column */
let tagToElementMap = new Map();
function wireActiveTagHighlighting() {
  const tagEls = $qsa('.opblock-tag');
  tagToElementMap.clear();
  tagEls.forEach(tag => {
    const title = tag.querySelector('h3 span')?.textContent?.trim();
    if (title) tagToElementMap.set(title, tag);
  });

  const options = {
    root: document.querySelector('.content'),
    rootMargin: '0px 0px -60% 0px',
    threshold: [0, 0.1, 0.4, 0.6, 1.0]
  };

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      const tag = entry.target;
      if (entry.isIntersecting) {
        const name = tag.querySelector('h3 span')?.textContent?.trim();
        if (name) setActiveTag(name);
      }
    });
  }, options);

  tagEls.forEach(t => observer.observe(t));
}

function setActiveTag(name) {
  const menu = document.getElementById("sidebar-menu");
  Array.from(menu.children).forEach(li => {
    if (li.dataset.tag === name) li.classList.add('active');
    else li.classList.remove('active');
  });
  const meta = document.getElementById('tag-meta');
  meta.textContent = `Exibindo endpoints para: ${name}`;
}

/* OPEN/CLOSE overlay code panel helpers */
const codePanel = document.getElementById('code-panel');
const codeView = document.getElementById('code-view');
const codeMethod = document.getElementById('code-method');
const codePath = document.getElementById('code-path');
const codeCopyBtn = document.getElementById('code-copy');
const codeOpenInSwaggerBtn = document.getElementById('code-open-in-swagger');
const codeCloseBtn = document.getElementById('code-close');

let currentlySelectedOpblock = null;

function openRightPanelFor(opblockEl) {
  if (!opblockEl) return;
  currentlySelectedOpblock = opblockEl;

  // Update header
  const methodText = opblockEl.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
  const pathText = opblockEl.querySelector('.opblock-summary-path')?.textContent?.trim() || '';

  codeMethod.className = 'method-pill ' + (methodText ? methodText.toLowerCase() : 'default');
  codeMethod.textContent = methodText || 'OP';
  codePath.textContent = pathText || '';

  // Fill content by cloning responses-wrapper inside the opblock (no need to actually expand it)
  codeView.innerHTML = '';

  const responses = opblockEl.querySelector('.responses-wrapper');
  if (responses) {
    const clone = responses.cloneNode(true);

    // Remove interactive elements that don't make sense here
    clone.querySelectorAll('.execute, .try-out, .btn.execute, .responses-request, .model').forEach(n => n.remove());

    clone.querySelectorAll('pre, code').forEach(el => {
      el.style.whiteSpace = 'pre';
      el.style.wordBreak = 'break-word';
      el.classList.add('hljs');
    });

    const rightBody = document.createElement('div');
    rightBody.className = 'right-body';
    rightBody.appendChild(clone);
    codeView.appendChild(rightBody);

    // Highlight code blocks
    rightBody.querySelectorAll('pre code').forEach(block => {
      try { hljs.highlightElement(block); } catch(e) {}
    });

    // Attach copy behavior
    codeCopyBtn.onclick = async () => {
      let text = "";
      const codes = rightBody.querySelectorAll('pre code');
      if (codes.length > 0) {
        text = Array.from(codes).map(c => c.innerText).join("\n\n---\n\n");
      } else {
        text = rightBody.innerText;
      }
      try {
        await navigator.clipboard.writeText(text);
        codeCopyBtn.textContent = "Copiado ✓";
        setTimeout(()=> codeCopyBtn.textContent = "Copiar", 1400);
      } catch(err) {
        codeCopyBtn.textContent = "Erro";
        setTimeout(()=> codeCopyBtn.textContent = "Copiar", 1400);
      }
    };

  } else {
    const msg = document.createElement('div');
    msg.className = 'panel-empty';
    msg.textContent = 'Nenhuma resposta de exemplo encontrada para este endpoint.';
    codeView.appendChild(msg);

    codeCopyBtn.onclick = () => {
      // fallback: copy path and method
      navigator.clipboard.writeText(`${methodText} ${pathText}`).then(() => {
        codeCopyBtn.textContent = "Copiado ✓";
        setTimeout(()=> codeCopyBtn.textContent = "Copiar", 1400);
      });
    };
  }

  // show panel
  codePanel.classList.remove('hidden');

  // focus for accessibility
  codePanel.setAttribute('tabindex', '-1');
  codePanel.focus();
}

function closeRightPanel() {
  codePanel.classList.add('hidden');
  currentlySelectedOpblock = null;
}

/* Intercept clicks on opblock-summary to prevent Swagger from expanding content on the left.
   Instead we show the right overlay panel with the cloned content. */
function bindEndpointClicksIntercept() {
  const content = document.getElementById('swagger-ui');

  // capture click events on summaries and prevent default propagation
  content.addEventListener('click', (e) => {
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;

    // Prevent Swagger UI handlers from expanding blocks in the left pane
    e.stopPropagation();
    e.preventDefault();

    // Get the parent opblock element
    const opblock = summary.closest('.opblock');
    if (!opblock) return;

    // Open overlay for this opblock
    openRightPanelFor(opblock);

    // Mark active tag in sidebar
    const tagEl = opblock.closest('.opblock-tag');
    const tagName = tagEl?.querySelector('h3 span')?.textContent?.trim();
    if (tagName) setActiveTag(tagName);
  }, { capture: true });

  // ensure keyboard activation (Enter/Space) also uses our handler
  content.addEventListener('keydown', (e) => {
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    if (e.key === 'Enter' || e.key === ' ') {
      e.stopPropagation();
      e.preventDefault();
      const opblock = summary.closest('.opblock');
      if (opblock) openRightPanelFor(opblock);
    }
  }, { capture: true });
}

/* Additional helpers: go to endpoint in the main view (scroll + flash) */
codeOpenInSwaggerBtn.addEventListener('click', () => {
  if (!currentlySelectedOpblock) return;
  // Scroll the opblock into view in the main content and flash a highlight
  currentlySelectedOpblock.scrollIntoView({ behavior: 'smooth', block: 'center' });
  // briefly add a glow
  const prev = currentlySelectedOpblock.style.boxShadow;
  currentlySelectedOpblock.style.boxShadow = "0 10px 36px rgba(14,165,233,0.12)";
  setTimeout(()=> currentlySelectedOpblock.style.boxShadow = prev || "", 900);
});

/* Close button */
codeCloseBtn.addEventListener('click', closeRightPanel);

/* Mobile sidebar toggle */
function initMobileControls() {
  const openBtn = document.getElementById('mobile-open-sidebar');
  const closeBtn = document.getElementById('close-sidebar');
  const sidebar = document.getElementById('sidebar');

  if (openBtn) openBtn.addEventListener('click', () => sidebar.classList.toggle('open'));
  if (closeBtn) closeBtn.addEventListener('click', () => sidebar.classList.remove('open'));
}

/* Bind clicks on opblock summaries that might be added later
   and keep sidebar updated when Swagger re-renders */
function bindMutationObservers() {
  const uiRoot = document.querySelector('.swagger-ui');
  if (!uiRoot) return;

  const mo = new MutationObserver((mutations) => {
    // Rebuild sidebar if new opblocks added
    let rebuild = false;
    for (const m of mutations) {
      if (m.addedNodes && m.addedNodes.length) rebuild = true;
    }
    if (rebuild) {
      // debounce
      clearTimeout(window._rebuild_sidebar_timeout);
      window._rebuild_sidebar_timeout = setTimeout(() => {
        buildSidebar();
        wireActiveTagHighlighting();
      }, 200);
    }
  });

  mo.observe(uiRoot, { childList: true, subtree: true });
}

/* Top-level init workflow */
(async function init() {
  try {
    // wait until Swagger UI inserts opblock tags
    await waitForSwaggerReady();

    // Build sidebar and wire interactions
    buildSidebar();
    wireActiveTagHighlighting();
    bindEndpointClicksIntercept();
    bindMutationObservers();
    initMobileControls();

    // If a tag or opblock already open in UI, open the overlay for the first opblock instead of letting Swagger show left block
    setTimeout(() => {
      const firstOp = document.querySelector('.opblock');
      if (firstOp) {
        // don't auto-open for every page load; leave closed. If you prefer auto-open, uncomment next line:
        // openRightPanelFor(firstOp);
      }
    }, 200);

  } catch (err) {
    console.warn("Não foi possível inicializar a interface melhorada:", err);
  }
})();
</script>

</body>
</html>
